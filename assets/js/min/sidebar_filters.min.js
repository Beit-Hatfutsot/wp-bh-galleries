/*! bh-galleries 2020-04-21 */

var $=jQuery,BH_filters=function(){var e={},o={sidebarFilters:$(".sidebar-filters"),countries:$(".sidebar-filters").children("#countries"),years:$(".sidebar-filters").children("#years"),subjects:$(".sidebar-filters").children("#subjects"),subsubjects:$(".sidebar-filters").children("#subsubjects"),container:""};e.init=function(){var e=o.sidebarFilters,t=o.countries,n=o.years,s=o.subjects,r=o.subsubjects;e.find("select").chosen({enable_split_word_search:!0,search_contains:!0,width:"100%"}),i(),s.change(c),t.add(n).add(s).add(r).change(function(){a()})};var i=function(){var e=new Image;o.container=document.createElement("div"),o.container.id="query-loader-container",e.src=_BH_General.settings.template+"/assets/images/general/loader.gif",e.id="query-loader",o.container.appendChild(e)},c=function(){var e=o.subjects,s=o.subsubjects,t=Array.prototype.slice.call(e[0].selectedOptions),r={},n=e.data("nonce");sub_options=s.find("option"),sub_options.addClass("hidden").each(function(){this.selected=!1}),t.forEach(function(e,t,n){r[t]=e.id}),$.ajax({type:"post",dataType:"json",url:_BH_General.ajaxurl,data:{action:"subject_filter",nonce:n,selectedOptionsIds:r,lang:_BH_General.settings.lang},success:function(e){e.length&&e.forEach(function(e,t,n){s.find("#"+e.term_id).removeClass("hidden")}),s.trigger("chosen:updated")}})},a=function(){var e=o.countries,t=o.years,n=o.subjects,s=o.subsubjects;l(r(e[0].selectedOptions),r(t[0].selectedOptions),r(n[0].selectedOptions),r(s[0].selectedOptions))},r=function(e){var s=[];return Array.prototype.slice.call(e).forEach(function(e,t,n){s.push(e.id)}),s},l=function(e,t,n,s){o.container;var r=$(".page-content"),i=o.sidebarFilters.data("nonce");r[0].innerHTML=o.container.outerHTML,$.ajax({type:"post",dataType:"html",url:_BH_General.ajaxurl,data:{action:"query_photos",nonce:i,countries:e,years:t,subjects:n,subsubjects:s,lang:_BH_General.settings.lang},success:function(e){e.length&&(r[0].innerHTML=e)},complete:function(e,t){BH_main.loaded()}})};return e.set=function(e,t,n){var s=o.sidebarFilters,r=o.countries,i=o.years,c=o.subsubjects;s.children("select").children("option").removeProp("selected"),e&&r.children("option#"+e.toString()).prop("selected",!0),t&&i.children("option#"+t.toString()).prop("selected",!0),n&&n.forEach(function(e,t,n){c.children("option#"+e.toString()).prop("selected",!0)}),s.children("select").trigger("chosen:updated"),a()},e}();Object.defineProperty(HTMLSelectElement.prototype,"selectedOptions",{get:function(){try{return document.querySelector(":checked"),function(){return this.querySelectorAll(":checked")}}catch(e){return function(){if(!this.multiple)return 0<=this.selectedIndex?[this.options[this.selectedIndex]]:[];for(var e=0,t=[];e<this.options.length;e++)this.options[e].selected&&t.push(this.options[e]);return t}}}()}),BH_filters.init();