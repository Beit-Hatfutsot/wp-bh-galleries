/*! bh-galleries 2019-12-03 */

var $=jQuery,BH_upload=function(){var e={},g={max_img_width:1280,max_img_height:1280,thumb_width:300,thumb_height:300,tmp_resized_img:"",tmp_thumbnail:"",tmp_resized_img_width:"",tmp_resized_img_height:"",ias:"",ias_browser_support_msg:"The File APIs are not fully supported in this browser",ias_file_type_msg:"Please upload an image file",step1_upload_failed_msg:"Upload has been failed, please try again",step1_upload_success_msg:"Upload completed successfully",resized_img:"",thumbnail:"",name:"",email:"",country:"",subjects:"",unassigned_subjects:"",title:"",year:"",description:""};e.init=function(){t(),i(),$(".btn-submit-step1 .submit-step").click(s),$(".btn-submit-step2 .submit-step").click(a),$(".btn-submit-step3 .submit-step").click(n),$(".btn-submit .clear").click(function(){var e=$(this).parent(".btn-submit").attr("class");"btn-submit btn-submit-step1"!=e&&b(1),setTimeout(function(){switch(e){case"btn-submit btn-submit-step3":w(3);case"btn-submit btn-submit-step2":w(2);case"btn-submit btn-submit-step1":w(1)}w("other")},BH_general.params.duration)});var e=$(".terms-label").next()[0];$("a#terms-link").fancybox({type:"inline",width:550,height:"auto",autoDimensions:!1,centerOnScroll:!0,onClosed:function(){$(".terms-label").after(e)}})};var t=function(){var e=document.getElementById("drag-drop-area");e.addEventListener("dragover",r,!1),e.addEventListener("dragleave",o,!1),e.addEventListener("drop",d,!1),$(".step1 #browse-button").click(function(){$('.step1 input[type="file"]').trigger("click")}),document.getElementById("fileToUpload").addEventListener("change",p,!1)},i=function(){$(".step2 .chosen-select").chosen({enable_split_word_search:!0,search_contains:!0,width:"100%"}),$(".step2 .field-wrap.required input").keyup(function(){$(this).val().length<3?($(this).parent().find(".glyphicon-remove-circle").removeClass("hidden"),$(this).parent().find(".glyphicon-ok-circle").addClass("hidden")):($(this).parent().find(".glyphicon-remove-circle").addClass("hidden"),$(this).parent().find(".glyphicon-ok-circle").removeClass("hidden")),_()}),$(".step2 input#unassigned_subjects").keyup(function(){$(this).val().length<3&&$("select#subject").next().children("ul").children("li.search-choice").length<1?($("select#subject").parent().find(".glyphicon-remove-circle").removeClass("hidden"),$("select#subject").parent().find(".glyphicon-ok-circle").addClass("hidden")):($("select#subject").parent().find(".glyphicon-remove-circle").addClass("hidden"),$("select#subject").parent().find(".glyphicon-ok-circle").removeClass("hidden")),_()}),$(".step2 .chosen-select").on("change",function(e,t){if($(this).next().hasClass("chosen-container-multi")&&1==$(this).next().children("ul").children("li.search-choice").length&&t.deselected&&$(".step2 input#unassigned_subjects").val().length<3)return $(this).parent().find(".glyphicon-remove-circle").removeClass("hidden"),$(this).parent().find(".glyphicon-ok-circle").addClass("hidden"),void _();$(this).parent().find(".glyphicon-remove-circle").addClass("hidden"),$(this).parent().find(".glyphicon-ok-circle").removeClass("hidden"),_()}),$(".step2 .chosen-select").on("chosen:no_results",function(e,t){$(this).next().hasClass("chosen-container-multi")&&($(".step2 input#unassigned_subjects").parent().slideDown(BH_general.params.duration),$(".step2 input#unassigned_subjects").val($(this).next().find("li.search-field input").val()),$(".step2 input#unassigned_subjects").val().length<3&&$(this).next().children("ul").children("li.search-choice").length<1?($(this).parent().find(".glyphicon-remove-circle").removeClass("hidden"),$(this).parent().find(".glyphicon-ok-circle").addClass("hidden")):($(this).parent().find(".glyphicon-remove-circle").addClass("hidden"),$(this).parent().find(".glyphicon-ok-circle").removeClass("hidden")),_())})},s=function(){$(".btn-submit-step1 .loader").show(),g.resized_img=g.tmp_resized_img,g.thumbnail=g.tmp_thumbnail,$(".btn-submit-step1 .loader").hide(),w(1),v(1,g.step1_upload_success_msg),b(2)},a=function(){$(".btn-submit-step2 .submit-step").unbind("click"),$(".btn-submit-step2 .loader").show(),$.ajax({type:"post",dataType:"json",url:_BH_General.ajaxurl,data:{action:"upload_photo",nonce:$(".step2").data("nonce"),image:g.resized_img,thumbnail:g.thumbnail,name:$(".step2 input#name").val(),email:$(".step2 input#email").val(),country:$(".step2 select#country").val(),subjects:$(".step2 select#subject").val(),unassigned_subjects:$(".step2 input#unassigned_subjects").val(),title:$(".step2 input#title").val(),year:$(".step2 select#year").val(),description:$(".step2 #description").val(),lang:_BH_General.settings.lang},success:function(e){$.isEmptyObject(e)||0!=e.status&&1!=e.status||(f(e.url),b(3),BH_filters.set(e.country,e.year,e.subjects))},complete:function(e,t){$(".btn-submit-step2 .loader").hide()}})},n=function(){$(".btn-submit-step3 .loader").show(),$(".btn-submit-step3 .loader").hide(),b(1),w(3),w(2),w(1),w("other")},r=function(e){w(1),w("other"),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy",$(".step1 #drag-drop-area").addClass("hover")},o=function(e){$(".step1 #drag-drop-area").removeClass("hover")},d=function(e){if(e.stopPropagation(),e.preventDefault(),window.File&&window.FileReader&&window.FileList&&window.Blob){var t=e.dataTransfer.files;return l(t)?(setTimeout(function(){$(".btn-submit-step1").slideDown(BH_general.params.duration)},BH_general.params.duration),$(".step1 #drag-drop-area").removeClass("hover"),!0):(v(1,g.ias_file_type_msg),$(".step1 #drag-drop-area").removeClass("hover"),!1)}return v(1,g.ias_browser_support_msg),$(".step1 #drag-drop-area").removeClass("hover"),!1},p=function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t=e.target.files;return l(t)?(setTimeout(function(){$(".btn-submit-step1").slideDown(BH_general.params.duration)},BH_general.params.duration),!0):(v(1,g.ias_file_type_msg),!1)}return v(1,g.ias_browser_support_msg),!1},l=function(e){for(var t,i=!1,s=0;t=e[s];s++)if(t.type.match("image.*")){$(".step1 .drag-drop-inside").hide(),c(t,$(".step1 .image-preview")),c(t,$(".step2 .photo-details-preview")),c(t,$(".step3 .photo-share-preview")),u(t),setTimeout(function(){m()},2*BH_general.params.duration),i=!0;break}return i},c=function(e,i){var s=new FileReader;s.onload=function(e){var t=document.createElement("div");t.className="image-wrapper",t.innerHTML='<img src="'+s.result+'" />',i.append(t)},s.readAsDataURL(e)},u=function(e){var t=new FileReader;t.onload=function(e){var s=new Image;s.src=t.result,s.onload=function(){var e=s.width,t=s.height;t<e?e>g.max_img_width&&(t*=g.max_img_width/e,e=g.max_img_width):t>g.max_img_height&&(e*=g.max_img_height/t,t=g.max_img_height),g.tmp_resized_img_width=e,g.tmp_resized_img_height=t;var i=document.createElement("canvas");i.width=e,i.height=t,i.getContext("2d").drawImage(this,0,0,e,t),g.tmp_resized_img=i.toDataURL("image/jpeg")}},t.readAsDataURL(e)},m=function(){var e=$(".step1 .image-preview img").width()/2,t=$(".step1 .image-preview img").height()/2;g.ias=$(".step1 .image-preview img").imgAreaSelect({handles:"corners",aspectRatio:"1:1",fadeDuration:BH_general.params.duration,instance:!0,onSelectEnd:function(e,t){h(g.tmp_resized_img,t.x1,t.y1,t.width,t.height)}}),g.ias.setOptions({show:!0,x1:e,y1:t,x2:1+e,y2:1+t}),g.ias.animateSelection(e-100,t-100,99+e,99+t,BH_general.params.duration),h(g.tmp_resized_img,e-100,t-100,200,200)},h=function(e,t,i,s,a){var n=g.tmp_resized_img_width,r=g.tmp_resized_img_height,o=$(".step1 .image-preview img").width(),d=$(".step1 .image-preview img").height(),p=r<n?n/o:r/d,l=Math.round(p*t),c=Math.round(p*i),u=Math.round(p*s),m=Math.round(p*a),h=new Image;h.src=e,h.onload=function(){var e=document.createElement("canvas");e.width=g.thumb_width,e.height=g.thumb_height,e.getContext("2d").drawImage(h,l,c,u,m,0,0,g.thumb_width,g.thumb_height),g.tmp_thumbnail=e.toDataURL("image/jpeg")}},_=function(){$(".step2 .field-wrap.required .glyphicon-ok-circle.hidden").length?$(".btn-submit-step2").slideUp(BH_general.params.duration):$(".btn-submit-step2").slideDown(BH_general.params.duration)},f=function(e){var t=$(".btn-submit-step3 .fb-share-button");t.attr("data-href",e),t.children("a").attr("href","https://www.facebook.com/sharer/sharer.php?u="+e+"&amp;src=sdkpreparse")},b=function(e){1<e?($(".upload-form .step-title-wrap, .upload-form .step-indicator-wrap").css({"margin-top":"-25px"}),$(".upload-form .step").slideUp(BH_general.params.duration),setTimeout(function(){$(".upload-form .step-title, .upload-form .step-indicator").removeClass("active"),$(".upload-form .step-title"+e+", .upload-form .step-indicator"+e).addClass("active"),$(".upload-form .step-title-wrap").css({"margin-top":"0"}),$(".upload-form .step-indicator-wrap").css({"margin-top":"10px"}),$(".upload-form .step"+e).slideDown(BH_general.params.duration)},BH_general.params.duration)):($(".upload-form").slideUp(BH_general.params.duration),setTimeout(function(){$(".upload-form .step-title, .upload-form .step-indicator").removeClass("active"),$(".upload-form .step-title1, .upload-form .step-indicator1").addClass("active"),$(".upload-form .step").hide(),$(".upload-form .step1").show()},BH_general.params.duration))},v=function(e,t){$(".step-msg"+e).html(t)},w=function(e){switch(e){case 1:""!=g.ias&&g.ias.cancelSelection(),$(".step1 .image-preview").html(""),$(".step-msg1").html(""),function(e){e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()}($('.step1 input[type="file"]')),$(".step1 #filename").html(""),$(".step1 .drag-drop-inside").show(),g.tmp_resized_img="",g.tmp_thumbnail="",$(".btn-submit-step1").slideUp(BH_general.params.duration);break;case 2:$(".btn-submit-step2").slideUp(BH_general.params.duration),$(".step2 input, .step2 textarea").val(""),$(".step2 .chosen-select option").prop("selected",!1),$(".step2 .chosen-select").trigger("chosen:updated"),$(".step2 .glyphicon-remove-circle").addClass("hidden"),$(".step2 .glyphicon-ok-circle").addClass("hidden"),$(".btn-submit-step2 .submit-step").click(a);break;case 3:break;case"other":$(".step2 .photo-details-preview").html(""),$(".step3 .photo-share-preview").html("")}};e.loaded=function(){$(window).resize(y).resize()};var y=function(){};return e}();$.extend($.imgAreaSelect.prototype,{animateSelection:function(e,t,i,s,a){var n=$.extend($("<div/>")[0],{ias:this,start:this.getSelection(),end:{x1:e,y1:t,x2:i,y2:s}});$(n).animate({cur:1},{duration:a,step:function(e,t){var i=t.elem.start,s=t.elem.end,a=Math.round(i.x1+(s.x1-i.x1)*e),n=Math.round(i.y1+(s.y1-i.y1)*e),r=Math.round(i.x2+(s.x2-i.x2)*e),o=Math.round(i.y2+(s.y2-i.y2)*e);t.elem.ias.setSelection(a,n,r,o),t.elem.ias.update()}})}}),BH_upload.init(),$(window).load(BH_upload.loaded());